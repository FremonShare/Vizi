<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Vizi</title>
</head>
<body>
	<div id="container" style="width:800px; height:600px; position:absolute;background-color:red"></div>
	<div id="timeDisplay" style="width:15%; height:15%; position:absolute;left:124px;top:10px;"></div>
	<div id="fractionDisplay" style="width:15%; height:15%; position:absolute;left:124px;top:30px;"></div>

	<script>
	var CLOSURE_NO_DEPS = true;
	</script>
    <script src="../libs/JQuery/jquery-1.6.4.js"></script>
    <script src="../libs/jquery-mousewheel-3.0.4/jquery.mousewheel.js"></script>
	<script src="../libs/three.js.r58/three.js"></script>
	<script src="../libs/three.js.r58/stats.min.js"></script>
	<script src="../libs/requestAnimationFrame/RequestAnimationFrame.js"></script>
	<script src="../build-debug/vizi.js"></script>
	<script>

	var timeDisplay = document.getElementById("timeDisplay");
	var fractionDisplay = document.getElementById("fractionDisplay");
	var cylinderTransform = null;
	
	$(document).ready(function() {
		var container = document.getElementById("container");
		
		var app = new Vizi.Application();
		app.initialize( { container : container, displayStats:false } );

		var root = new Vizi.Object;
		
		var cube = createCube();
		root.addChild(cube);

		var cylinder = createCylinder();
		cylinderTransform = cylinder.getComponent(Vizi.Transform);
		root.addChild(cylinder);
		
		app.addObject(root);
		root.realize();

		//app.onMouseDown = onAppMouseDown;
		//app.onMouseMove = onAppMouseMove;
		//app.onMouseUp = onAppMouseUp;
		app.run();
	}
	);

	function createCube() {	
		var o = new Vizi.Object;

		var xfm = new Vizi.Transform;

		var c = new Vizi.CubeVisual;

		var p = new Vizi.Picker;
		p.addEventListener("mousedown", onPickerMouseDown);
		p.addEventListener("mousemove", onPickerMouseMove);
		p.addEventListener("mouseup", onPickerMouseUp);
		
		var t = new Vizi.Timer({duration: 5000, loop:true});
		
		t.addEventListener("time", onTimeChanged);
		t.addEventListener("fraction", onTimeFractionChanged);
		t.start();
		
		o.addComponent(xfm);
		o.addComponent(c);
		o.addComponent(p);
		o.addComponent(t);

		return o;
	}


	function createCylinder() {	
		var o = new Vizi.Object;

		var xfm = new Vizi.Transform;
		xfm.position.set(1, 1, 1);
		var c = new Vizi.CylinderVisual({ height: .3, radiusTop: .1, radiusBottom: .1 });

		o.addComponent(xfm);
		o.addComponent(c);
		return o;
	}
		
	var once = false;
	function onTimeChanged(t) { 
		if (!once) { 
			console.log(this);
			once = true;
		}
		 
		timeDisplay.innerHTML = t;
	}

	function onTimeFractionChanged(f) {
		fractionDisplay.innerHTML = f.toFixed(2);
	}
		
	function onAppMouseDown(event)
	{
		console.log("Mouse down", this, event);
	}

	function onAppMouseMove(event)
	{
		console.log("Mouse move ", event);
	}

	function onAppMouseUp(event)
	{
		console.log("Mouse up ", event);
	}

	
	function onPickerMouseDown(event)
	{
		console.log("Picker mouse down", this, event.point);
		cylinderTransform.position.copy(event.point);
	}

	function onPickerMouseMove(event)
	{
		console.log("Picker mouse move ", event.point);
		cylinderTransform.position.copy(event.point);
	}

	function onPickerMouseUp(event)
	{
		console.log("Picker mouse up ", event.point);
		cylinderTransform.position.copy(event.point);
	}	
	</script>
	
</body>
</html>