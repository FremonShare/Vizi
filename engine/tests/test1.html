<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Vizi</title>
</head>
<body>
	<div id="container" style="width:800px; height:600px; position:absolute;background-color:red"></div>
	<div id="timeDisplay" style="width:15%; height:15%; position:absolute;left:124px;top:10px;"></div>
	<div id="fractionDisplay" style="width:15%; height:15%; position:absolute;left:124px;top:30px;"></div>

	<script>
	var CLOSURE_NO_DEPS = true;
	</script>
    <script src="../libs/JQuery/jquery-1.6.4.js"></script>
    <script src="../libs/jquery-mousewheel-3.0.4/jquery.mousewheel.js"></script>
	<script src="../libs/three.js.r58/three.js"></script>
	<script src="../libs/three.js.r58/stats.min.js"></script>
	<script src="../libs/requestAnimationFrame/RequestAnimationFrame.js"></script>
	<script src="../build-debug/vizi.js"></script>
	<script>

	var timeDisplay = document.getElementById("timeDisplay");
	var fractionDisplay = document.getElementById("fractionDisplay");
	var cube = null;
	var cylinder = null;
	
	$(document).ready(function() {
		var container = document.getElementById("container");
		
		var app = new Vizi.Application();
		app.initialize( { container : container, displayStats:true } );

		var root = new Vizi.Object;
		var transform = new Vizi.Transform;
		
		var dragger = new Vizi.PlaneDragger;
		dragger.addEventListener("mouseover", onDraggerMouseOver);
		dragger.addEventListener("mouseout", onDraggerMouseOut);
		dragger.addEventListener("mousedown", onDraggerMouseDown);
		dragger.addEventListener("mouseup", onDraggerMouseUp);
		dragger.addEventListener("drag", onDraggerDrag);
		
		var timer = new Vizi.Timer({duration: 5000, loop:true});
		
		timer.addEventListener("time", onTimeChanged);
		timer.addEventListener("fraction", onTimeFractionChanged);
		timer.start();

		root.addComponent(transform);
		root.addComponent(dragger);
		root.addComponent(timer);
		
		cube = createCube();
		root.addChild(cube);

		cylinder = createCylinder();
		cylinderTransform = cylinder.getComponent(Vizi.Transform);
		root.addChild(cylinder);
		
		app.addObject(root);
		root.realize();

		app.run();
	}
	);

	function createCube() {	
		var o = new Vizi.Object;

		var transform = new Vizi.Transform;

		var visual = new Vizi.Visual(
				{ geometry: new THREE.CubeGeometry(2, 2, 2),
					material: new THREE.MeshBasicMaterial({color:0x808080})
				});

		
		o.addComponent(transform);
		o.addComponent(visual);

		return o;
	}


	function createCylinder() {	
		var o = new Vizi.Object;

		var transform = new Vizi.Transform;
		transform.position.set(1, 1, 1);
		
		var visual = new Vizi.Visual(
				{ geometry: new THREE.CylinderGeometry(.1, .1, .3, 100, 100, false),
					material: new THREE.MeshBasicMaterial()
				});

		
		o.addComponent(transform);
		o.addComponent(visual);
		return o;
	}
		
	function onTimeChanged(t) { 
		timeDisplay.innerHTML = t;
	}

	function onTimeFractionChanged(f) {
		fractionDisplay.innerHTML = f.toFixed(2);
	}

	var savedColor = 0;
	function onDraggerMouseOver(event)
	{
		savedColor = cube.visual.material.color.getHex();
		cube.visual.material.color.setHex(0xaaaa00);
	}
		
	function onDraggerMouseOut(event)
	{
		cube.visual.material.color.setHex(savedColor);
	}

	var offset = null;
	function onDraggerMouseDown(event)
	{
		cylinder.transform.position.copy(event.point);
		offset = event.point.clone();
	}
	
	function onDraggerMouseUp(event)
	{
	}	

	function onDraggerDrag(point)
	{
		cube.transform.position.copy(point);
		var cylinderpos = point.clone().add(offset);
//		cylinder.transform.position.copy(cylinderpos);
	}	
	</script>
	
</body>
</html>